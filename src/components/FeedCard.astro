---
import { formatDate } from "../lib/formatDate";
import { topicMeta } from "../config/topics";

type Props = {
  href: string;
  title: string;
  description?: string;
  image: string;
  date?: Date | string;
  topic?: string;
  locked?: boolean;
  pinned?: boolean;
  pinnedStyle?: string;
  searchText?: string;
  dateKey?: string;
  anchorId?: string;
};

const {
  href,
  title,
  description = "",
  image,
  date,
  topic,
  locked = false,
  pinned = false,
  pinnedStyle,
  searchText,
  dateKey,
  anchorId,
} = Astro.props as Props;

const meta = topicMeta(topic);
const showPinBadge = pinned && import.meta.env.PUBLIC_ENABLE_PINNED_BADGE !== "false";
const pinLabelMap: Record<string, string> = {
  event: "S·ª± ki·ªán",
  announcement: "Th√¥ng b√°o",
  memory: "K·ª∑ ni·ªám",
};
const pinLabel = pinnedStyle && pinLabelMap[pinnedStyle] ? pinLabelMap[pinnedStyle] : "Ghim";
---

<a
  href={href}
  class={`feed-card ${locked ? "is-locked" : ""} ${pinned ? "is-pinned" : ""}`}
  data-reveal
  data-search={searchText}
  data-date={dateKey}
  id={anchorId}
>
  <div class="feed-card__head">
    <div class="feed-card__topic" style={`--topic-color:${meta.color};`}>
      <span class="feed-card__icon">{meta.icon}</span>
      <span>{meta.label}</span>
    </div>
    {date && <div class="feed-card__date">{formatDate(date)}</div>}
  </div>
  {showPinBadge && (
    <span class="feed-card__pin" data-pin-style={pinnedStyle ?? "default"} aria-label="B√†i ghim">
      üìå {pinLabel}
    </span>
  )}

  <h3 class="feed-card__title">{title}</h3>
  {description && !locked && <p class="feed-card__desc">{description}</p>}
  {locked && <p class="feed-card__desc">üîí ƒê√£ kh√≥a</p>}

  <div class="feed-card__media">
    <img src={image} alt="" loading="lazy" decoding="async" />
  </div>
</a>
