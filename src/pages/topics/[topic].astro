---
import BaseLayout from "../../layouts/BaseLayout.astro";
import RansomTitle from "../../components/RansomTitle.astro";
import PolaroidCard from "../../components/PolaroidCard.astro";
import { TOPICS, topicLabel } from "../../config/topics";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  return TOPICS.map((t) => ({ params: { topic: t.slug } }));
}

const { topic = "two-of-us" } = Astro.params;
const label = topicLabel(topic);

const posts = (await getCollection("posts"))
  .filter((p) => !p.data.draft)
  .filter((p) => (p.data.topic ?? "two-of-us") === topic)
  .sort((a, b) => +new Date(b.data.pubDate) - +new Date(a.data.pubDate));
---

<BaseLayout title={label} active="topics">
  <main class="mx-auto max-w-6xl px-5 pb-20">
    <section class="paper edge-torn mt-8 p-6 sm:p-10" data-reveal>
      <p class="kicker text-[11px] text-black/50">Topic</p>
      <RansomTitle text={label} as="h1" stampEvery={0} class="text-[40px] sm:text-[56px]" />
      <p class="mt-3 text-black/70">
        Drop new posts into this collection by setting <code>topic: {topic}</code> in frontmatter.
      </p>

      <div class="topic-bar">
        {TOPICS.map((t) => (
          <a class="topic-chip" href={`/topics/${t.slug}`}>{t.label}</a>
        ))}
      </div>

      <div class="mt-6">
        <a class="btn" href="/topics">Back to topics</a>
      </div>
    </section>

    <section class="mt-10" aria-label="Topic entries">
      {posts.length === 0 ? (
        <p class="text-white/70">No entries yet.</p>
      ) : (
        <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {posts.map((p, i) => (
            <div style={`--tilt:${((i % 5) - 2) * 1.2}deg`}>
              <PolaroidCard
                href={`/entries/${p.slug}`}
                image={p.data.cover}
                title={p.data.title}
                date={p.data.pubDate}
                tilt={(i % 5) - 2}
              />
            </div>
          ))}
        </div>
      )}
    </section>
  </main>
</BaseLayout>
