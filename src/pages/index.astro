---
import BaseLayout from "../layouts/BaseLayout.astro";
import RansomTitle from "../components/RansomTitle.astro";
import FeedCard from "../components/FeedCard.astro";
import TopicCard from "../components/TopicCard.astro";
import { getCollection } from "astro:content";
import { TOPICS } from "../config/topics";

const posts = (await getCollection("posts"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => {
    const pinnedA = a.data.pinned ? 1 : 0;
    const pinnedB = b.data.pinned ? 1 : 0;
    if (pinnedA !== pinnedB) return pinnedB - pinnedA;
    return b.data.pubDate.valueOf() - a.data.pubDate.valueOf();
  });

const counts: Record<string, number> = {};
for (const p of posts) {
  const t = p.data.topic ?? "two-of-us";
  counts[t] = (counts[t] ?? 0) + 1;
}

---

<BaseLayout title="Nháº­t kÃ½ â€” Two Against The World" active="entries" description="Kho lÆ°u nháº­t kÃ½">
  <section class="paper edge-torn px-6 py-7 sm:px-8 sm:py-8" data-reveal>
    <p class="kicker text-[18px] text-black/50">ğŸ©¸â€œTin YÃªuâ€ğŸ–¤</p>
    <div class="mt-2">
  <RansomTitle
    text="Our-main-eventsğŸ¸"
    as="h1"
    stampEvery={0}
    class="text-[44px] sm:text-[56px] ransom-red"
  />
</div>

    <p class="mt-4 text-black/70">
      Cáº©n tháº­n nhÃ©, cháº¡m vÃ o lÃ  cÆ¡ duyÃªn cá»§a chÃºng ta sáº½ thÃ nh giao Æ°á»›c ğŸ•¯ï¸.
    </p>

    <div class="topic-grid">
      {TOPICS.map((t) => (
        <TopicCard slug={t.slug} label={t.label} icon={t.icon} color={t.color} count={counts[t.slug] ?? 0} />
      ))}
    </div>
  </section>

  <section class="mt-10">
    <div class="pinterest-grid">
      {posts.map((post) => (
        <FeedCard
          href={`/entries/${post.slug}`}
          image={post.data.cover}
          title={post.data.title}
          description={post.data.description}
          date={post.data.pubDate}
          topic={post.data.topic}
          locked={post.data.topic === "trash-bin"}
          pinned={post.data.pinned}
        />
      ))}
    </div>
  </section>
</BaseLayout>
